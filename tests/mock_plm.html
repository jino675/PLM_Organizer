<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Mock PLM Page</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        .row {
            margin-bottom: 10px;
            border-bottom: 1px solid #ccc;
            padding: 10px;
        }

        .label {
            font-weight: bold;
            color: #555;
        }

        .value {
            color: #000;
            margin-left: 10px;
        }

        .section {
            border: 1px solid #aaa;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }
    </style>
</head>

<body>
    <h1>PLM System Mock</h1>
    <p>Click buttons to open scenarios in <b>New Tabs</b> to test context switching.</p>
    <button onclick="openScenario(1)">Open Scenario 1 (Standard)</button>
    <button onclick="openScenario(2)">Open Scenario 2 (No Defect)</button>
    <button onclick="openScenario(3)">Open Scenario 3 (Complex)</button>
    <button onclick="openScenario(4)">Open Scenario 4 (Real World)</button>
    <hr>

    <div id="content-area">
        <!-- Dynamic Content Loaded Here -->
    </div>

    <script>
        const scenarios = {
            1: {
                defect: "DF123456-78901",
                plm: "P000001-12345",   // 6 digits
                title: "[ABC] Standard Title"
            },
            2: {
                defect: "",
                plm: "P999999-00000",   // 6 digits
                title: "Title  with  Spaces"
            },
            3: {
                defect: "DF987654-32100",
                plm: "P555555-55555",   // 6 digits
                title: "[REQ]  Title with   spaces  Final"
            },
            4: {
                defect: "DF111111-22222",
                plm: "P777777-88888",   // 6 digits
                title: "[string1] [string2] this is an example  X28Q332(issue model ID)"
            }
        };

        function template(data) {
            // Hardcode 18 rows for the 19th-child test
            let rows = "";
            for (let i = 1; i < 19; i++) {
                rows += `<tr><td>Row ${i} (Empty)</td></tr>`;
            }

            return `
                <div id="content">
                    <!-- Selector: #content > div:nth-child(1) > table > ... -->
                    <div class="header-box">
                        <table border="1" style="width:100%; border-collapse: collapse;">
                            <tbody>
                                <tr>
                                    <th style="width:30%; background:#f0f0f0;">
                                        <strong>${data.plm}</strong>
                                    </th>
                                    <th style="text-align:left; padding:10px;">
                                        <span class="icon">[ICON]</span> 
                                        ${data.title} 
                                        <span class="model-id">(MODEL_X28)</span>
                                    </th>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="row" style="margin: 20px 0;">
                        <span class="label">System Info:</span>
                        <span class="value">Ver 1.1 (Real-Site Mock)</span>
                    </div>

                    <!-- Selector: #content > div.dataGrid.nolist.mgT-1 > table > tbody > tr:nth-child(19) > ... -->
                    <div class="dataGrid nolist mgT-1" style="border: 1px solid #ddd; padding: 10px;">
                        <h3>Detailed Info (DataGrid)</h3>
                        <table style="width:100%">
                            <tbody>
                                ${rows}
                                <tr>
                                    <td>
                                        <table style="background: #fff8e1; border: 1px dashed #ffa000; width: 100%;">
                                            <tbody>
                                                <tr>
                                                    <td>
                                                        <span class="label">KONA ID (Link):</span>
                                                        <a href="#" style="font-weight:bold; color:blue;">${data.defect}</a>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Download Simulation -->
                    <div class="section" style="background-color: #eef; margin-top: 15px; border: 1px solid #999; padding: 15px;">
                        <h3>Downloads</h3>
                        <p>Click below to test file detection:</p>
                        <a href="data:text/plain;charset=utf-8,Test Content" download="test_real_structure.txt">
                           <button>Download Simulation File</button>
                        </a>
                        <hr>
                        <button onclick="bulkDownload()">Bulk Download</button>
                    </div>
                </div>
            `;
        }

        function bulkDownload() {
            // Trigger multiple downloads
            const download = (filename, content) => {
                const element = document.createElement('a');
                element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
                element.setAttribute('download', filename);
                element.style.display = 'none';
                document.body.appendChild(element);
                element.click();
                document.body.removeChild(element);
            };

            download("bulk_file_1.txt", "File 1 content");
            setTimeout(() => download("bulk_file_2.log", "File 2 content"), 500);
            setTimeout(() => download("bulk_file_3.data", "File 3 content"), 1000);
        }

        function getScenarioFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return params.get('scenario') || 1;
        }

        function openScenario(id) {
            window.open(`mock_plm.html?scenario=${id}`, '_blank');
        }

        // Init
        const currentId = getScenarioFromUrl();
        document.getElementById('content-area').innerHTML = template(scenarios[currentId]);
        document.title = `Mock PLM - Scenario ${currentId}`;
    </script>
</body>

</html>